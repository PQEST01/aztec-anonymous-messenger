import { GrumpkinAddress } from '../address/index.js';
import { ViewingKeyData } from '../viewing_key/index.js';
const NOTE_SECRET_SIZE = 32;
export class DecryptedNote {
    constructor(data, ephPubKey, noteSecret) {
        this.data = data;
        this.ephPubKey = ephPubKey;
        this.noteSecret = noteSecret;
        if (noteSecret.length !== NOTE_SECRET_SIZE) {
            throw new Error('Invalid note secret buffer.');
        }
    }
    static fromBuffer(buf) {
        let dataStart = 0;
        const data = ViewingKeyData.fromBuffer(buf.slice(dataStart, dataStart + ViewingKeyData.SIZE));
        dataStart += ViewingKeyData.SIZE;
        const ephPubKey = new GrumpkinAddress(buf.slice(dataStart, dataStart + GrumpkinAddress.SIZE));
        dataStart += GrumpkinAddress.SIZE;
        const noteSecret = buf.slice(dataStart, dataStart + NOTE_SECRET_SIZE);
        return new DecryptedNote(data, ephPubKey, noteSecret);
    }
    toBuffer() {
        return Buffer.concat([this.data.toBuffer(), this.ephPubKey.toBuffer(), this.noteSecret]);
    }
}
DecryptedNote.SIZE = ViewingKeyData.SIZE + GrumpkinAddress.SIZE + NOTE_SECRET_SIZE;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjcnlwdGVkX25vdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbm90ZV9hbGdvcml0aG1zL2RlY3J5cHRlZF9ub3RlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFekQsTUFBTSxnQkFBZ0IsR0FBRyxFQUFFLENBQUM7QUFFNUIsTUFBTSxPQUFPLGFBQWE7SUFheEIsWUFDa0IsSUFBb0IsRUFDcEIsU0FBMEIsRUFDMUIsVUFBa0I7UUFGbEIsU0FBSSxHQUFKLElBQUksQ0FBZ0I7UUFDcEIsY0FBUyxHQUFULFNBQVMsQ0FBaUI7UUFDMUIsZUFBVSxHQUFWLFVBQVUsQ0FBUTtRQUVsQyxJQUFJLFVBQVUsQ0FBQyxNQUFNLEtBQUssZ0JBQWdCLEVBQUU7WUFDMUMsTUFBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1NBQ2hEO0lBQ0gsQ0FBQztJQWxCRCxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQVc7UUFDM0IsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLE1BQU0sSUFBSSxHQUFHLGNBQWMsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsU0FBUyxHQUFHLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzlGLFNBQVMsSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDO1FBQ2pDLE1BQU0sU0FBUyxHQUFHLElBQUksZUFBZSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLFNBQVMsR0FBRyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUM5RixTQUFTLElBQUksZUFBZSxDQUFDLElBQUksQ0FBQztRQUNsQyxNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxTQUFTLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQztRQUN0RSxPQUFPLElBQUksYUFBYSxDQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQVlNLFFBQVE7UUFDYixPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDM0YsQ0FBQzs7QUF4Qk0sa0JBQUksR0FBRyxjQUFjLENBQUMsSUFBSSxHQUFHLGVBQWUsQ0FBQyxJQUFJLEdBQUcsZ0JBQWdCLENBQUMifQ==