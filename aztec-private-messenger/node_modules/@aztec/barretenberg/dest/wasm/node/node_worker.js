import { parentPort } from 'worker_threads';
import { NodeListener, TransportServer } from '../../transport/index.js';
import { BarretenbergWasm } from '../barretenberg_wasm.js';
if (!parentPort) {
    throw new Error('InvalidWorker');
}
async function dispatch({ fn, args }) {
    if (fn === '__destroyWorker__') {
        transportServer.stop();
        return;
    }
    if (!barretenbergWasm[fn]) {
        throw new Error(`dispatch error, function not found: ${fn}`);
    }
    return await barretenbergWasm[fn](...args);
}
const barretenbergWasm = new BarretenbergWasm();
const transportListener = new NodeListener();
const transportServer = new TransportServer(transportListener, dispatch);
barretenbergWasm.on('log', (...args) => transportServer.broadcast({ fn: 'emit', args: ['log', ...args] }));
transportServer.start();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZV93b3JrZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvd2FzbS9ub2RlL25vZGVfd29ya2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1QyxPQUFPLEVBQUUsWUFBWSxFQUFlLGVBQWUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3RGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBRTNELElBQUksQ0FBQyxVQUFVLEVBQUU7SUFDZixNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0NBQ2xDO0FBRUQsS0FBSyxVQUFVLFFBQVEsQ0FBQyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQWU7SUFDL0MsSUFBSSxFQUFFLEtBQUssbUJBQW1CLEVBQUU7UUFDOUIsZUFBZSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3ZCLE9BQU87S0FDUjtJQUNELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsRUFBRTtRQUN6QixNQUFNLElBQUksS0FBSyxDQUFDLHVDQUF1QyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0tBQzlEO0lBQ0QsT0FBTyxNQUFNLGdCQUFnQixDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDN0MsQ0FBQztBQUVELE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO0FBQ2hELE1BQU0saUJBQWlCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUM3QyxNQUFNLGVBQWUsR0FBRyxJQUFJLGVBQWUsQ0FBYyxpQkFBaUIsRUFBRSxRQUFRLENBQUMsQ0FBQztBQUN0RixnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxJQUFXLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDLEtBQUssRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ2xILGVBQWUsQ0FBQyxLQUFLLEVBQUUsQ0FBQyJ9