import { ProofId } from '@aztec/barretenberg/client_proofs';
import { createDebugLogger } from '@aztec/barretenberg/log';
import { batchDecryptNotes, recoverTreeNotes, } from '@aztec/barretenberg/note_algorithms';
import { OffchainAccountData, OffchainDefiDepositData, OffchainJoinSplitData, } from '@aztec/barretenberg/offchain_tx_data';
import { retryUntil } from '@aztec/barretenberg/retry';
import { Timer } from '@aztec/barretenberg/timer';
import { EventEmitter } from 'events';
import { CacheRequest } from '../cache_request/index.js';
import { BoundedSerialQueue } from '@aztec/barretenberg/fifo';
import { NotePicker } from '../note_picker/index.js';
import { DbOps } from './db_ops.js';
const debug = createDebugLogger('bb:user_state');
const debugDecrypt = createDebugLogger('bb:user_state_decrypt');
export var UserStateEvent;
(function (UserStateEvent) {
    UserStateEvent["UPDATED_USER_STATE"] = "UPDATED_USER_STATE";
})(UserStateEvent = UserStateEvent || (UserStateEvent = {}));
export class UserState extends EventEmitter {
    constructor(userData, grumpkin, noteAlgos, noteDecryptor, db, rollupProvider) {
        super();
        this.userData = userData;
        this.grumpkin = grumpkin;
        this.noteAlgos = noteAlgos;
        this.noteDecryptor = noteDecryptor;
        this.db = db;
        this.rollupProvider = rollupProvider;
        this.decryptQueue = new BoundedSerialQueue(10);
        this.dbOpsQueue = new BoundedSerialQueue(10);
        this.pendingNoteNullifiersRequest = new CacheRequest(async () => await rollupProvider.getPendingNoteNullifiers());
        this.notePickersRequest = new CacheRequest(async () => await this.getNotePickers());
        this.latestQueuedRollup = userData.syncedToRollup;
    }
    async init() {
        await this.resetData();
        this.decryptQueue.start();
        this.dbOpsQueue.start();
    }
    async shutdown(flush = false) {
        if (flush) {
            await this.decryptQueue.end();
            await this.dbOpsQueue.end();
        }
        else {
            await this.decryptQueue.cancel();
            await this.dbOpsQueue.cancel();
        }
    }
    async flush() {
        await this.decryptQueue.syncPoint();
        await this.dbOpsQueue.syncPoint();
    }
    /**
     * Should be called before reading any state that has persistent storage that may have changed underfoot.
     * If the user has synched further underfoot, we refresh our notepicker and emit an update event.
     */
    async syncFromDb() {
        const { syncedToRollup } = (await this.db.getUser(this.userData.accountPublicKey));
        if (syncedToRollup !== this.userData.syncedToRollup) {
            this.userData.syncedToRollup = syncedToRollup;
            this.notePickersRequest.clearCache();
            this.emit(UserStateEvent.UPDATED_USER_STATE, this.userData.accountPublicKey);
        }
    }
    isSynchronised(latestRollupId) {
        // this.debug(`isSynchronised: ${this.userData.syncedToRollup} >= ${latestRollupId}`);
        return this.userData.syncedToRollup >= latestRollupId;
    }
    async awaitSynchronised(latestRollupId, timeout) {
        await retryUntil(() => this.isSynchronised(latestRollupId), 'user synchronised', timeout);
    }
    getUserData() {
        return { ...this.userData };
    }
    processBlocks(blockContexts) {
        return this.decryptQueue.put(() => this.handleBlocks(blockContexts));
    }
    async handleBlocks(blockContexts) {
        // Remove any blocks we've already processed.
        blockContexts = blockContexts.filter(b => b.rollup.rollupId > this.latestQueuedRollup);
        // If nothings left, or these blocks don't lead on immediately from last queued rollup, do nothing.
        if (blockContexts.length == 0) {
            this.debugDecrypt(`no blocks left after filtering.`);
            return;
        }
        else if (blockContexts[0].rollup.rollupId !== this.latestQueuedRollup + 1) {
            this.debugDecrypt(`ignoring non contiguous blocks, ${blockContexts[0].rollup.rollupId} !== ${this.latestQueuedRollup + 1}`);
            return;
        }
        this.latestQueuedRollup = blockContexts[blockContexts.length - 1].rollup.rollupId;
        const timer = new Timer();
        const from = blockContexts[0].rollup.rollupId;
        this.debugDecrypt(`blocks ${from} to ${from + blockContexts.length - 1}...`);
        const rollupProofData = blockContexts.map(b => b.rollup);
        const innerProofs = rollupProofData.map(p => p.getNonPaddingProofs()).flat();
        const offchainTxDataBuffers = blockContexts.map(b => b.block.offchainTxData).flat();
        const viewingKeys = [];
        const noteCommitments = [];
        const inputNullifiers = [];
        const offchainJoinSplitData = [];
        const offchainAccountData = [];
        const offchainDefiDepositData = [];
        innerProofs.forEach((proof, i) => {
            switch (proof.proofId) {
                case ProofId.DEPOSIT:
                case ProofId.WITHDRAW:
                case ProofId.SEND: {
                    const offchainTxData = OffchainJoinSplitData.fromBuffer(offchainTxDataBuffers[i]);
                    viewingKeys.push(...offchainTxData.viewingKeys);
                    const { noteCommitment1, noteCommitment2, nullifier1: inputNullifier1, nullifier2: inputNullifier2, } = innerProofs[i];
                    noteCommitments.push(noteCommitment1);
                    noteCommitments.push(noteCommitment2);
                    inputNullifiers.push(inputNullifier1);
                    inputNullifiers.push(inputNullifier2);
                    offchainJoinSplitData.push(offchainTxData);
                    break;
                }
                case ProofId.ACCOUNT: {
                    offchainAccountData.push(OffchainAccountData.fromBuffer(offchainTxDataBuffers[i]));
                    break;
                }
                case ProofId.DEFI_DEPOSIT: {
                    const offchainTxData = OffchainDefiDepositData.fromBuffer(offchainTxDataBuffers[i]);
                    viewingKeys.push(offchainTxData.viewingKey);
                    // There is only 1 note on the output of DEFI_DEPOSIT (claim note)
                    const { noteCommitment2, nullifier2: inputNullifier2 } = innerProofs[i];
                    noteCommitments.push(noteCommitment2);
                    inputNullifiers.push(inputNullifier2);
                    offchainDefiDepositData.push(offchainTxData);
                    break;
                }
            }
        });
        const viewingKeysBuf = Buffer.concat(viewingKeys.flat().map(vk => vk.toBuffer()));
        const decryptedTreeNotes = await batchDecryptNotes(viewingKeysBuf, this.userData.accountPrivateKey, this.noteDecryptor, this.grumpkin);
        const treeNotes = recoverTreeNotes(decryptedTreeNotes, inputNullifiers, noteCommitments, this.userData.accountPublicKey, this.noteAlgos);
        this.debugDecrypt(`done in ${timer.s()}s.`);
        await this.dbOpsQueue.put(async () => {
            const dbOps = new DbOps(this.userData, this.noteAlgos, this.db, this.grumpkin);
            await dbOps.handleTxs({
                blockContexts,
                rollupProofData,
                offchainJoinSplitData,
                offchainAccountData,
                offchainDefiDepositData,
                treeNotes,
            });
            this.notePickersRequest.clearCache();
            this.emit(UserStateEvent.UPDATED_USER_STATE, this.userData.accountPublicKey);
        });
    }
    async pickNotes(assetId, value, options = {}) {
        const { notePicker } = (await this.notePickersRequest.get()).find(np => np.assetId === assetId) || {};
        if (!notePicker) {
            return [];
        }
        const pendingNullifiers = await this.pendingNoteNullifiersRequest.get();
        return notePicker.pick(value, {
            ...options,
            excludedNullifiers: [...(options.excludedNullifiers || []), ...pendingNullifiers],
        });
    }
    async pickNote(assetId, value, options = {}) {
        const { notePicker } = (await this.notePickersRequest.get()).find(np => np.assetId === assetId) || {};
        if (!notePicker) {
            return;
        }
        const pendingNullifiers = await this.pendingNoteNullifiersRequest.get();
        return notePicker.pickOne(value, {
            ...options,
            excludedNullifiers: [...(options.excludedNullifiers || []), ...pendingNullifiers],
        });
    }
    async getSpendableNoteValues(assetId, options = {}) {
        const { notePicker } = (await this.notePickersRequest.get()).find(np => np.assetId === assetId) || {};
        if (!notePicker) {
            return [];
        }
        const pendingNullifiers = await this.pendingNoteNullifiersRequest.get();
        return notePicker.getSpendableNoteValues({
            ...options,
            excludedNullifiers: [...(options.excludedNullifiers || []), ...pendingNullifiers],
        });
    }
    async getSpendableSum(assetId, options = {}) {
        const { notePicker } = (await this.notePickersRequest.get()).find(np => np.assetId === assetId) || {};
        if (!notePicker) {
            return BigInt(0);
        }
        const pendingNullifiers = await this.pendingNoteNullifiersRequest.get();
        return notePicker
            .getSpendableNoteValues({
            ...options,
            excludedNullifiers: [...(options.excludedNullifiers || []), ...pendingNullifiers],
        })
            .reduce((sum, v) => sum + v, BigInt(0));
    }
    async getSpendableSums(options = {}) {
        const pendingNullifiers = await this.pendingNoteNullifiersRequest.get();
        return (await this.notePickersRequest.get())
            .map(({ assetId, notePicker }) => ({
            assetId,
            value: notePicker
                .getSpendableNoteValues({
                ...options,
                excludedNullifiers: [...(options.excludedNullifiers || []), ...pendingNullifiers],
            })
                .reduce((sum, v) => sum + v, BigInt(0)),
        }))
            .filter(assetValue => assetValue.value > BigInt(0));
    }
    async getMaxSpendableNoteValues(assetId, options = {}) {
        const { notePicker } = (await this.notePickersRequest.get()).find(np => np.assetId === assetId) || {};
        if (!notePicker) {
            return [];
        }
        const pendingNullifiers = await this.pendingNoteNullifiersRequest.get();
        return notePicker.getMaxSpendableNoteValues({
            ...options,
            excludedNullifiers: [...(options.excludedNullifiers || []), ...pendingNullifiers],
        });
    }
    async getBalance(assetId) {
        const { notePicker } = (await this.notePickersRequest.get()).find(np => np.assetId === assetId) || {};
        return notePicker ? notePicker.getSum() : BigInt(0);
    }
    async getBalances() {
        return (await this.notePickersRequest.get())
            .map(({ assetId, notePicker }) => ({ assetId, value: notePicker.getSum() }))
            .filter(assetValue => assetValue.value > BigInt(0));
    }
    async addProof({ tx, outputNotes }) {
        switch (tx.proofId) {
            case ProofId.DEPOSIT:
            case ProofId.WITHDRAW:
            case ProofId.SEND:
                this.debug(`adding pending payment tx: ${tx.txId}`);
                await this.db.upsertPaymentTx(tx);
                break;
            case ProofId.ACCOUNT:
                this.debug(`adding pending account tx: ${tx.txId}`);
                await this.db.upsertAccountTx(tx);
                break;
            case ProofId.DEFI_DEPOSIT: {
                this.debug(`adding pending defi tx: ${tx.txId}`);
                await this.db.upsertDefiTx(tx);
                break;
            }
        }
        await this.processPendingNote(outputNotes[0]);
        await this.processPendingNote(outputNotes[1]);
        // No need to do anything with proof.backwardLink (i.e., mark a note as chained).
        // But will have to clear the cache for pending note nullifers.
        // Rollup provider will return the nullifiers of pending notes, which will be excluded when the sdk is picking notes.
        this.pendingNoteNullifiersRequest.clearCache();
        this.notePickersRequest.clearCache();
        this.emit(UserStateEvent.UPDATED_USER_STATE, this.userData.accountPublicKey);
    }
    // ---------------
    // PRIVATE METHODS
    // ---------------
    /**
     * Purge pending txs no longer on server.
     */
    async resetData() {
        const pendingTxs = await this.rollupProvider.getPendingTxs();
        const pendingUserTxIds = (await this.db.getPendingUserTxs(this.userData.accountPublicKey)).map(tx => tx.txId);
        for (const userTxId of pendingUserTxIds) {
            if (!pendingTxs.some(tx => tx.txId.equals(userTxId))) {
                await this.db.removeUserTx(this.userData.accountPublicKey, userTxId);
            }
        }
        const pendingNotes = await this.db.getPendingNotes(this.userData.accountPublicKey);
        for (const note of pendingNotes) {
            if (!pendingTxs.some(tx => tx.noteCommitment1.equals(note.commitment) || tx.noteCommitment2.equals(note.commitment))) {
                await this.db.removeNote(note.nullifier);
            }
        }
    }
    async getNotePickers() {
        const notesMap = new Map();
        const notes = await this.db.getNotes(this.userData.accountPublicKey);
        notes.forEach(note => {
            const assetNotes = notesMap.get(note.assetId) || [];
            notesMap.set(note.assetId, [...assetNotes, note]);
        });
        const assetIds = [...notesMap.keys()].sort((a, b) => (a > b ? 1 : -1));
        return assetIds.map(assetId => ({ assetId, notePicker: new NotePicker(notesMap.get(assetId)) }));
    }
    async processPendingNote(note) {
        if (!note) {
            return;
        }
        const { ownerPubKey, value } = note.treeNote;
        if (!ownerPubKey.equals(this.userData.accountPublicKey) || !note.allowChain) {
            return;
        }
        if (value) {
            await this.db.addNote(note);
            this.debug(`adding chainable pending note with value: ${value}.`);
        }
        return note;
    }
    debug(...args) {
        const [first, ...rest] = args;
        debug(`${this.userData.accountPublicKey.toShortString()}: ${first}`, ...rest);
    }
    debugDecrypt(...args) {
        const [first, ...rest] = args;
        debugDecrypt(`${this.userData.accountPublicKey.toShortString()}: ${first}`, ...rest);
    }
}
export class UserStateFactory {
    constructor(grumpkin, noteAlgos, noteDecryptor, db, rollupProvider) {
        this.grumpkin = grumpkin;
        this.noteAlgos = noteAlgos;
        this.noteDecryptor = noteDecryptor;
        this.db = db;
        this.rollupProvider = rollupProvider;
    }
    async createUserState(user) {
        const userState = new UserState(user, this.grumpkin, this.noteAlgos, this.noteDecryptor, this.db, this.rollupProvider);
        await userState.init();
        return userState;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXNlcl9zdGF0ZS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFFNUQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDNUQsT0FBTyxFQUNMLGlCQUFpQixFQUdqQixnQkFBZ0IsR0FDakIsTUFBTSxxQ0FBcUMsQ0FBQztBQUM3QyxPQUFPLEVBQ0wsbUJBQW1CLEVBQ25CLHVCQUF1QixFQUN2QixxQkFBcUIsR0FDdEIsTUFBTSxzQ0FBc0MsQ0FBQztBQUM5QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFdkQsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRWxELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFFdEMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRXpELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRTlELE9BQU8sRUFBRSxVQUFVLEVBQXFCLE1BQU0seUJBQXlCLENBQUM7QUFHeEUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUVwQyxNQUFNLEtBQUssR0FBRyxpQkFBaUIsQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUNqRCxNQUFNLFlBQVksR0FBRyxpQkFBaUIsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBRWhFLE1BQU0sQ0FBTixJQUFZLGNBRVg7QUFGRCxXQUFZLGNBQWM7SUFDeEIsMkRBQXlDLENBQUE7QUFDM0MsQ0FBQyxFQUZXLGNBQWMsR0FBZCxjQUFjLEtBQWQsY0FBYyxRQUV6QjtBQUVELE1BQU0sT0FBTyxTQUFVLFNBQVEsWUFBWTtJQU96QyxZQUNVLFFBQWtCLEVBQ2xCLFFBQWtCLEVBQ2xC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