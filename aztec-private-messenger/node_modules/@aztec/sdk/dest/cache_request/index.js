import { MemorySerialQueue } from '../serial_queue/index.js';
export class CacheRequest {
    constructor(fn, expireAfter = 1000) {
        this.fn = fn;
        this.expireAfter = expireAfter;
        this.validUntil = 0;
        this.serialQueue = new MemorySerialQueue();
    }
    async get() {
        return await this.serialQueue.push(async () => {
            if (Date.now() > this.validUntil) {
                this.res = await this.fn();
            }
            this.validUntil = Date.now() + this.expireAfter;
            return this.res;
        });
    }
    clearCache() {
        this.validUntil = 0;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY2FjaGVfcmVxdWVzdC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUU3RCxNQUFNLE9BQU8sWUFBWTtJQUt2QixZQUE2QixFQUFvQixFQUFtQixjQUFjLElBQUk7UUFBekQsT0FBRSxHQUFGLEVBQUUsQ0FBa0I7UUFBbUIsZ0JBQVcsR0FBWCxXQUFXLENBQU87UUFIOUUsZUFBVSxHQUFHLENBQUMsQ0FBQztRQUNmLGdCQUFXLEdBQUcsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO0lBRTJDLENBQUM7SUFFbkYsS0FBSyxDQUFDLEdBQUc7UUFDZCxPQUFPLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDNUMsSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRTtnQkFDaEMsSUFBSSxDQUFDLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQzthQUM1QjtZQUNELElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7WUFDaEQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDO1FBQ2xCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVNLFVBQVU7UUFDZixJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztJQUN0QixDQUFDO0NBQ0YifQ==